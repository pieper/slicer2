<HTML>
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
   <META NAME="keywords" CONTENT="Image Guided Surgery, Surgical Planning Lab, 3D Slicer">
   <META NAME="description" CONTENT="3D Slicer">
   <META NAME="distribution" CONTENT="global">
   <TITLE>3D Slicer</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" LINK="#0000FF" VLINK="#800080">
&nbsp;
<BR><!-- HEADER TABLE -->
<TABLE BORDER=0 CELLSPACING=0 WIDTH="100%" >
<TR>
<TD VALIGN=TOP><!-- TITLE TABLE -->
<TABLE BORDER=0 CELLSPACING=0 >
<TR>
<TD VALIGN=TOP><IMG SRC="slicer.jpg" HEIGHT=175 WIDTH=175>&nbsp;</TD>
</TR>

<TR>
<TD VALIGN=BOTTOM BGCOLOR="#0000FF">
<CENTER><B><FONT COLOR="#FFFFFF"><FONT SIZE=+3>User's Guide&nbsp;</FONT></FONT></B></CENTER>
</TD>
</TR>
</TABLE>
&nbsp;</TD>

<TD ALIGN=LEFT VALIGN=TOP><B><I>Table of Contents</I></B>&nbsp;
<BR><A HREF="#IntroSection">Introduction</A>&nbsp;
<BR><A HREF="#SlicesSection">Slices</A>&nbsp;
<BR><A HREF="#FileSection">File</A>&nbsp;
<BR><A HREF="#EditSection">Edit</A>&nbsp;
<BR><A HREF="#RegisterSection">Register</A>&nbsp;
<BR><A HREF="#MeasureSection">Measure</A>&nbsp;
<BR><A HREF="#ModelsSection">Models</A>&nbsp;
<BR><A HREF="#VolumesSection">Volumes</A>&nbsp;
<BR><A HREF="#GuidanceSection">Guidance</A>&nbsp;
<BR><A HREF="#RealtimeSection">Realtime</A>&nbsp;
<BR><A HREF="#ViewSection">View</A>&nbsp;
<BR><A HREF="#SaveSection">Save</A>&nbsp;
<BR><A HREF="#ColorsSection">Colors</A>&nbsp;
<BR><A HREF="#AnnoSection">Anno</A>&nbsp;
<BR><A HREF="mrmlaid.html">MRMLaid</A>&nbsp;
<BR><A HREF="appendix.html">Appendix</A>&nbsp;
</TD>

</TR>
</TABLE>
<!-- CONTENT TABLE -->
<TABLE BORDER=0 CELLSPACING=0 WIDTH="100%" >
<TR>
<TD VALIGN=TOP>&nbsp;
<BR>

<!-- INTRO -->
<A NAME="IntroSection"></A>
<H2>
Introduction</H2>
<P>
The <I>3D Slicer</I> presents an interactive environment for creating and 
exploring 3D scenes comprised of multiple medical data sets.  
Volume data sets, such as from an MR or CT scan, can be visualized by showing slices
that cut through the data.  Multiple volumes can be displayed overlaid on the
same slices.  Surface models of anatomical structures can be created
and visualized in 3D space relative to the slices.
<P>
<UL>
<LI><A HREF="#FileMap">Map</A>
<LI><A HREF="#FileGettingAround">Getting Around</A>
<LI><A HREF="#FileGettingStarted">Getting Started</A>
</UL>

<A NAME="FileMap"></A>
<H3>
Map</H3>
<P>
<IMG SRC="map.jpg" >&nbsp;<A NAME="FileGettingAround"></A>
<H3>
Getting Around</H3>
<P>
The <B>Main Menu</B> displays buttons for the most commonly used options. When
a button is pressed (like the <B>Intro</B> button in the image below),
it continues to appear pressed, and a group of tabs related to that button
appear below the main menu.  Options that are needed less often are 
available by clicking on the <B>More</B> menu.
<P>
<IMG SRC="menu.gif" >
<P>
Typically, the leftmost tab is the <B>Info</B> tab which displays the relevant 
portion of this User's Guide.  Links in the information are red and
underlined. Click on a link to show its topic in the window.
<P>
For some options, the tabs are numbered. In these circumstances, use
the tabs in order.
<P>
This documentation will refer to the page under a tab by the name of
a button on the Main Menu followed by a dash and the name of the
tab. The <B>File-Info</B> page is an example.

<A NAME="FileGettingStarted"></A>
<H3>
Getting Started</H3>

<P>To compose a 3D scene, click the <B>File</B> button on the
Main Menu and follow the instructions on its <B>Info</B> page.

<P>Once a scene is loaded into the <I>3D Slicer</I>, adjust the slices
using the <B>Slice Controls</B> as described on the <B>Info-Slices</B> page.

<P>Adjust the 3D view by dragging the mouse in the <B>3D Window</B>
while pressing one of the following mouse buttons:
<UL>
<LI>
<B>Left:</B> Rotate</LI>
<LI>
<B>Middle:</B> Shift (Press the SHIFT key and the left mouse button
on a two-button mouse).</LI>
<LI>
<B>Right:</B> Zoom</LI>
</UL>
Move the mouse over the <B>Closeup Window</B> to find the most commonly used
View controls. Other View controls are available by clicking the <B>View</B>
button on the Main Menu. Read their description on the <B>View-Info</B>
page.

<P>Adjust the window, level, and threshold of volumes using the <B>Volumes Popup</B> 
which can be found though one of the following ways:
<UL>
<LI>
Click the right mouse button on the annotation in the lower left corner
of a <B>Slice Window</B>.
<LI>
When viewing the <B>Slice Controls</B>, click the right mouse button on
the name of the volume.
</UL>
<P>
Click the <B>Volumes</B> button on the Main Menu to set other volume parameters
for interpolation, choosing color palettes, and filtering.
<P>
If you find a bug, or have a question, please click the <B>Report a Bug</B>
button beneath the <B>Closeup Window</B>.

<!-- SLICES -->
<BR>
<A NAME="SlicesSection"></A>
<H2>
Slices</H2>
<UL>
<LI><A HREF="#SlicesOverview">Overview</A>
<LI><A HREF="#SlicesAccessingControls">Accessing the Controls</A>
<LI><A HREF="#SlicesUsingControls">Using the Controls</A>
<LI><A HREF="#SlicesOrientation">Slice Orientation</A>
</UL>

<A NAME="SlicesOverview"></A>
<H3>
Overview</H3>
A slice consists of three layers:&nbsp;
<UL>
<LI>
Background&nbsp;</LI>

<LI>
Foreground&nbsp;</LI>

<LI>
Label&nbsp;</LI>
</UL>
Different volumes can be displayed on each layer. The vertical <B>Opacity
Slider</B> beneath the Toolbar and next to the Closeup Window controls
the opacity of the <B>Foreground</B> layer as it is overlaid on the <B>Background</B>
layer. Volumes that are label maps may be displayed on the <B>Label</B>
layer. The outline of each labeled structure will be drawn on the slice
in the color that corresponds to that label value. See the <B>Colors-Info</B>
page for information on setting the colors.

<A NAME="SlicesAccessingControls"></A>
<H3>
Accessing the Controls</H3>
<P>
The <I>3D Slicer</I> has various <B>View Modes</B>. When the View mode is set
to <B>Normal</B>, the Slice Controls are visible above each slice. In the
other View modes, the orientation of each slice is written in the upper
left corner of each Slice Window.  To access the Slice Controls for a slice,
move the mouse over this word, but do <I>not</I> click.

<A NAME="SlicesUsingControls"></A>
<H3>
Using the Controls</H3>
<P>
Each slice is outlined in either red, yellow, or green. The Slice Controls
have the corresponding color of the slice they control.&nbsp;

<P>For each button or menu on the Slice Controls, there is a name for the
control to the left of the control. The name itself is also a button or
menu, but it does not share the color of the other controls. These controls
apply to <I>all</I> the slices rather than just one.

<A NAME="SlicesOrientation"></A>
<H3>
Slice Orientation</H3>
<P>
The <B>Orient</B> menu on a Slice Control window, sets the orientation
of the slice. There are 3 types of choices:&nbsp;
<UL>
<LI>
Relative to the patient&nbsp;</LI>

<LI>
Relative to the view&nbsp;</LI>

<LI>
Relative to the data&nbsp;</LI>
</UL>

<H4>
Relative to the Patient</H4>
<P>
These choices (Axial, Sagittal, and Coronal) are centered at the Focal
Point (see the <B>View-Info</B> page for information on how to change the Focal
Point) and may be moved with an offset specified in millimeters.&nbsp;
<H4>
Relative to the View</H4>
<P>
These choices (InPlane, InPlane90, InPlaneNeg90, Perpendicular) are centered
at the Focal Point and may be moved with an offset specified in millimeters.
Their orientation is relative to the user's viewing direction at the time
that the orientation is selected using the <B>Orient</B> menu on a Slice
Control window.&nbsp;
<H4>
Relative to the Data</H4>
<P>
These choices (OrigSlice, AxiSlice, SagSlice, CorSlice) are independent
of the Focal Point. They are the actual slices in the Volume data set.
The offset is specified by a slice number instead of millimeters. The OrigSlice
option depicts the data as the collection of 2D slices that form a 3D volume.

<BR><!-- DEVELOPING -->

<A NAME="DevlSection"></A>
<H2>
Developing</H2>
<UL>
<LI><A HREF="#DevlOverview">Overview</A>
<LI><A HREF="#DevlTabs">Adding Tabs</A>
<LI><A HREF="#DevlAlgo">Adding Algorithms</A>
</UL>

<A NAME="DevlOverview"></A>
<H3>
Overview</H3>
<P>
Developers can easily extend the <I>3D Slicer</I> to meet specific needs.
The user interface is written in the Tcl/Tk scripting language, and algorithms
are written in C++ using the Visualization Toolkit (VTK) available at http://www.kitware.com.

<A NAME="DevlTabs"></A>
<H3>
Adding Tabs</H3>
<P>
Buttons can be added to the <B>Main Menu</B> by following these steps:&nbsp;
<UL>
<LI>
Copy the <I>Custom.tcl</I> file and rename it with the name of your new
option.</LI>

<LI>
Edit the file and replace the word <I>Custom</I> with your new name.
(Follow the rest of these instructions using your new name in place
of the word <I>Custom</I>.)
Then follow the comments on each procedure to implement your new functionality.</LI>

<LI>
Edit the <I>slicer.init</I> file to add a <I>Tabs</I> entry.
See the HTML version of the Slicer's documentation for details of the <I>slicer.init</I>
file.</LI>

<LI>
Edit the <I>slicerdoc.html</I> file in the <I>doc</I> directory to add helpful 
information for users.  Add a <I>CustomSection</I> to the Table of Contents and
then create the <I>CustomSection</I> by following the other sections as an example.
Following in this format makes the next step much easier.</LI>

<LI>
Edit the <I>Info.txt</I> file in the <I>doc</I> directory to insert on-line documentation
directly into the program.  Enclose your new text within tags <B>&lt;&lt;Custom&gt;&gt;</B>
and <B>&lt;&lt;/Custom&gt;&gt;</B>.  The text in this file is a subset of HTML, so you can merely
copy the text from your <I>CustomSection</I> as long as you use only the following
HTML tags: <B>B I UL LI P BR H2 H3 H4</B>, and the following HTML elements:
<B>&amp;gt; &amp;lt; &amp;nbsp; &amp;amp</B>.  Convert any <B>&lt;IMG&gt;</B> tags to
<B>&lt;G&gt;filename.gif&lt;/G&gt;</B>.   Anything inside tags
<B>&lt;A&gt;</B> and <B>&lt;/A&gt;</B> will become a link to an <B>&lt;H3&gt;</B> tag
that contains identical text.
Just follow the <I>Info.txt</I> file for examples.
</LI>
</UL>

<A NAME="DevlAlgo"></A>
<H3>
Adding Algorithms</H3>
<P>
The <I>3D Slicer's</I> Tcl scripts create instantiations of VTK objects.
Adding new algorithms involves writing new VTK objects in C++ and calling
them from the Tcl scripts.&nbsp;

<P>The <I>3D Slicer's</I> core functionality uses VTK objects that are
not part of the general VTK package. If you need to make a change to any
of these objects (such as adding a new effect to the slice editor), then
first contact <I>slicer@ai.mit.edu</I>.&nbsp;<A NAME="FileSection"></A>
<BR>

<!-- FILE -->
<H2>
File</H2>
<UL>
<LI><A HREF="#FileOverview">Overview of MRML</A>
<LI><A HREF="#FileAddVolume">Adding a Volume</A>
<LI><A HREF="#FileAddModel">Adding a Model</A>
<LI><A HREF="#FileAddTransform">Adding a Transform</A>
<LI><A HREF="#FileAddFile">Adding the Contents of a File</A>
<LI><A HREF="#FileAddLink">Adding a Link of a File</A>
<LI><A HREF="#FileReorder">Reordering the Nodes</A>
<LI><A HREF="#FileEdit">Editing a Node</A>
<LI><A HREF="#FileSeparators">Using Separators</A>
<LI><A HREF="#FileLoad">Loading the File</A>
<LI><A HREF="#FileExample">Example of Creating a File</A>
</UL>

<A NAME="FileOverview"></A>
<H3>
Overview of MRML</H3>
<P>
The <I>3D Slicer</I> displays scenes specified as MRML files.  For a description
of MRML, click on <B>MRMLaid</B> on the Table of Contents.

<A NAME="FileAddVolume"></A>
<H3>
Adding a Volume</H3>
<P>
From the <B>File-Create</B> page, add a new Volume node using the following
steps:&nbsp;
<UL>
<LI>
Click the <B>Append</B> menubutton and select <B>Volume</B> to bring up the
File Popup.</LI>

<LI>
There is a <B>First Image</B> button followed by an entry field.
You may type the prefix of the first image of the volume in the field,
or you may click the First Image button to launch a graphical tool for
finding the file.  (<B>TIP:</B> Type the first part of the prefix, and then 
press the ENTER key to launch the graphical tool for specifying the remainder
of the prefix.)  The <B>prefix</B> is the full path name for the file without
the portion after a period.  For example, if
the file name is "/local/data/I.001", then the prefix is "/local/data/I".

<LI>
Type the number of the last image in the file.  For example, if the
last image file name is "/local/data/I.060", then type "60".</LI>

<LI>
Give the volume a name that will appear on the user interface.

<LI> If the volume is a label map, the click the <B>Is a Label Map</B> button.

<LI>
There are many more attributes for a volume that an be automatically determined by 
reading the image headers.  The <I>3D Slicer</I> will automatically read the image
headers if the <B>Read Headers</B> button is pressed in at the time you click
<B>Apply</B>.  Un-click the Read Headers button to enter header information manually.
</UL>

<A NAME="FileAddModel"></A>
<H3>
Adding a Model</H3>
<P>
From the <B>File-Create</B> page, add a new Model node using the following
steps:&nbsp;
<UL>
<LI>
Click the <B>Append</B> menubutton and select <B>Model</B> to bring up the
File Popup.</LI>

<LI>
There is a <B>Prefix</B> button followed by an entry field.
You may type the prefix of the model's file in the field,
or you may click the Prefix button to launch a graphical tool for
finding the file.  (<B>TIP:</B> Type the first part of the prefix, and then 
press the ENTER key to launch the graphical tool for specifying the remainder
of the prefix.)  The <B>prefix</B> is the full path name for the file without
the portion after a period.  For example, if
the file name is "/local/data/skin.vtk", then the prefix is "/local/data/skin".

<LI>
Select the name of a color from the <B>Color</B> menubutton.  The options
in this list come from the Color nodes in the MRML file that that the <I>3D Slicer</I>
was started up with.  If there were no Color nodes in the MRML file, or if the
<I>3D Slicer</I> was started without a MRML file, the the Color nodes are taken
from the <I>Defaults.mrml</I> file in the <I>3D Slicer's</I> home directory.
To define your own colors, follow the instructions on the <B>Colors-Info</B> page.

<LI>
In the <B>Name</B> field, provide a name for your model that will appear on the
user interface.

<LI>
Click the <B>Apply</B> button to finish.

</UL>

<A NAME="FileAddTransform"></A>
<H3>
Adding a Transform</H3>
<P>
From the <B>File-Create</B> page, add a new Transform node using the following
steps:&nbsp;
<UL>
<LI>
Click the <B>Append</B> menubutton and select <B>Transform</B> to bring up the
File Popup.</LI>

<LI>
Enter either a matrix, rotation, translation, or any combination.  The matrix
will be applied first, followed by the rotation, followed by the translation.
Specify the 4x4 matrix as 16 numbers with the top row first.
<LI>
Click <B>Apply</B>.
</UL>

<A NAME="FileAddFile"></A>
<H3>
Adding the Contents of a File</H3>
<P>
From the <B>File-Create</B> page, add the contents of another MRML file by
following these steps:
<UL>
<LI>
Click the <B>Append</B> menubutton and select <B>File</B> to bring up the
File Popup.</LI>

<LI>
There is a <B>Prefix</B> button followed by an entry field.
You may type the prefix of the MRML file in the field,
or you may click the Prefix button to launch a graphical tool for
finding the file.  (<B>TIP:</B> Type the first part of the prefix, and then 
press the ENTER key to launch the graphical tool for specifying the remainder
of the prefix.)  The <B>prefix</B> is the full path name for the file without
the portion after a period.  For example, if
the file name is "/local/data/scene.mrml", then the prefix is "/local/data/scene".
<LI>
Click <B>Apply</B>.
</UL>

<A NAME="FileAddLink"></A>
<H3>
Adding a Link to a File</H3>
<P>
From the <B>File-Create</B> page, add a link to another MRML file by following
these steps:
<UL>
<LI>
Click the <B>Append</B> menubutton and select <B>Url</B> to bring up the
File Popup.</LI>

<LI>
Make sure the <B>Link</B> button is pressed.
<LI>
Type the full path name of the MRML file in the <B>Url</B> field.
<LI>
Click <B>Apply</B>.
</UL>

<P>Nodes may be reordered by cutting and pasting them using the menu that
appears when the right mouse button is clicked on the listbox on the <B>File-Edit</B>
page.&nbsp;

<P>Go to the <B>File-Apply</B> page to save the MRML file.&nbsp;

<P>Click the <B>Load and Display Data</B> button to delete all data sets
from the <I>3D Slicer</I> and load the new MRML file in its place. The
MRML file does not need to be saved first, but this is recommended.&nbsp;

<A NAME="FileReorder"></A>
<H3>
Reordering the Nodes</H3>
<P>
To change the order of nodes in a MRML file, follow these steps:
<UL>
<LI>
In the listbox, click the right mouse button on the node you wish to move.
<LI>
From the menu of options, choose <B>Cut Selection</B>.
<LI>
Click the right mouse button on the node you wish to move the first node in front of.
From the menu that appears, choose <B>Paste Selection</B>.
</UL>

<A NAME="FileEdit"></A>
<H3>
Editing a Node</H3>
<P>
To change the attributes of a node in the MRML file, double click on the
node in the listbox to launch a popup.  Change any attributes, and click <B>Apply</B>.

<A NAME="FileSeparators"></A>
<H3>
Using Separators</H3>
<P>
A separator is not a node with attributes, but it is a useful construct 
for building MRML files.  A separator encapsulates the nodes inside it such 
that they are invisible to nodes outside the separator.  Separators can be used
to achieve two types of effects:
<UL>
<LI> Any transform node inside a separator will only affect volumes
and models that are positioned both inside the separator, and after the transform.
<LI> Any model node inside a separator will be interpreted to belong to the volume
node that is the most immediately above it and also inside the separator.
</UL>

<A NAME="FileLoad"></A>
<H3>
Loading the File</H3>
<P>
When you have completed editing a MRML file using the <B>File-Create</B> page,
then click the <B>Load and Display Data</B> button to load the MRML file into
the <I>3D Slicer</I>.

<A NAME="FileExample"></A>
<H3>
Example</H3>
<P>
Here is an example MRML file that registers two volumes be applying a transform
to Volume B:
<BR>Volume A
<BR>Transform
<BR>Volume B

<BR><!-- EDIT -->

<A NAME="EditSection"></A>
<H2>
Edit</H2>
<UL>
<LI><A HREF="#EditOverview">Overview</A>
<LI><A HREF="#EditSetup">Setup</A>
<LI><A HREF="#EditEffects">Applying Effects</A>
<LI><A HREF="#EditThreshold">Effects: Threshold</A>
<LI><A HREF="#EditErode">Effects: Erode</A>
<LI><A HREF="#EditRemoveIslands">Effects: Remove Islands</A>
<LI><A HREF="#EditChangeIsland">Effects: Change Islands</A>
<LI><A HREF="#EditPolygon">Effects: Draw Polygons</A>
<LI><A HREF="#EditBrush">Effects: Draw Brush Strokes</A>
<LI><A HREF="#EditChangeLabel">Effects: Change Label</A>
<LI><A HREF="#EditAssignLabels">Effects: Assign Labels</A>
<LI><A HREF="#EditOutput">Saving the Output</A>
<LI><A HREF="#EditModel">Making Surface Models</A>
</UL>
<A NAME="EditOverview"></A>
<H3>
Overview</H3>
<P>
Editing is the process of applying a series of effects to a volume of data.
When an effect is applied to a volume, the output is placed in a volume
called the <B>Working</B> volume. The Working volume can be merged with
another volume called the <B>Result</B>. <B>Merging</B> is the process
of copying every non-zero voxel of the Working volume to the Result volume.&nbsp;

<P>Surface models can be made from either the Working or Result volumes.&nbsp;<A NAME="EditSetup"></A>
<H3>
Setup</H3>
<P>
Go to the <B>Edit-Setup</B> page and select the volume to edit from the
<B>Original Volume</B> menu. Click the <B>Start Editing</B> button to setup
the user interface for an editing session. You may not perform editing
effects until this has been clicked. You can click <B>Stop Editing</B>
when finished to return the display to normal.&nbsp;<A NAME="EditEffects"></A>
<H3>
Applying Effects</H3>
<P>
Effects can be applied to either the Original volume or the Working volume.
By default, thresholding applies to the Original, and all other effects
apply to the Working. This can be overriden using the <B>Input</B> control
on the Effects page.&nbsp;

<P>The output of an effect is always stored in the Working volume.&nbsp;

<P>Use the <B>Dimension</B> button to apply effects to a single slice,
the entire 3D volume, or to every slice in the volume.&nbsp;<A NAME="EditThreshold"></A>
<H3>
Effects: Threshold</H3>
<P>
Threshold replaces all voxel values within a range with a single, new label
value.&nbsp;

<P>Thresholding and Brush Strokes are interactive effects, which means
that the effect can be seen before it is applied. The other effects are
non-interactive.&nbsp;<A NAME="EditErode"></A>
<H3>
Effects: Erode</H3>
<P>
Set all voxels that border the background label to the background label.
The effect has far greater impact in 3D mode than in 2D.&nbsp;<A NAME="EditRemoveIslands"></A>
<H3>
Effects: Remove Islands</H3>
<P>
Remove all islands below a certain size. Islands are removed by setting
the label value of all voxels in the island to equal the background label.&nbsp;<A NAME="EditChangeIsland"></A>
<H3>
Effects: Change Islands</H3>
<P>
Change all voxels in an island to a different label value.&nbsp;<A NAME="EditPolygon"></A>
<H3>
Draw Polygons</H3>
Draw polygons on which ever slice the mouse is clicked on.&nbsp;

<P>The left mouse button can work in 3 modes: Draw, Select, and Move.&nbsp;

<P>When drawing, a point at the location where the mouse is clicked is
inserted into the polygon at after the last selected point.&nbsp;

<P>Select a point by entering Select mode and clicking on a point. Select
more than one point by drawing a yellow box around the points to be selected.&nbsp;

<P>Move points by selecting them and then entering Move mode. Click anywhere
on the slice and drag to move the points by the amount of dragging.&nbsp;<A NAME="EditBrush"></A>
<H3>
Effects: Draw Brush Strokes</H3>
<P>
Draw either lines or points of various radii.&nbsp;<A NAME="EditChangeLabel"></A>
<H3>
Effects: Change Label</H3>
<P>
Change all voxels with a certain label value to another label value.&nbsp;<A NAME="EditAssignLabels"></A>
<H3>
Effects: Assign Labels</H3>
<P>
Assign all islands a unique label value beginning with 1, but not including
the background label value.&nbsp;<A NAME="EditOutput"></A>
<H3>
Effects: Saving the Output</H3>
<P>
Go to the <B>Edit-Output</B> page to save write the Working or Result volumes
to disk. Type the file prefix (for example, /d/working would produce files
/d/working.001, /d/working.002, ...), and click the <B>Write</B> button.&nbsp;

<P>Typically, a number of effects are applied to the Original volume to
create a label map for one structure in the Working volume. The Working
volume is then merged to the Result volume. <B>Merging</B> is the process
of copying every non-zero voxel of the Working volume to the Result volume.
Then, the editing process starts over to create a new structure in the
Working volume, and this second structure is merged with the Result volume.&nbsp;<A NAME="EditModel"></A>
<H3>
Effects: Making Surface Models</H3>
<P>
Go to the <B>Edit-Models</B> page and select which volume to make models
from. Then, for each volume, set its label value, set its file name, give
it a name that will appear on the user interface, and click the <B>Add
Model</B> button. When finished building a list of models to make, click
the <B>Make Models</B> button. The program will perform processing for
a while, and then the models will appear in the 3D Window.&nbsp;

<P>More parameters, such as smoothing and decimation, can be specified
by clicking <B>Show More Options</B> and setting the options to the desired
values before clicking the <B>Make Models</B> button.

<!-- REGISTER -->
<A NAME="RegisterSection"></A>
<H2>
Register</H2>

<H3>
Setup</H3>
<P>
Go to the <B>Register-Setup</B> page. Set the <B>Reference Volume</B> to
the volume that does <I>not</I> move. Then select the volume that will be moved.
<H3>
Manual Registration</H3>
<P>
Go to the <B>Register-Manual</B> page. Move the volume either by using
the sliders, or the toolbar.

<P>To use the Toolbar (to the right of the Close-up Window), click the <B>Tran</B>
button for <B>Translate</B>, click the left mouse button on a slice window,
and drag in the direction of desired translation.

<P>Rotate around the axis perpendicular to a slice by clicking the <B>Rot</B>
button on the toolbar for <B>Rotate</B>. Then click the left mouse button
on the slice window and drag as if drawing an arc around the center of
the image. The angle spanned by the arc specifies the angle of rotation.

<!-- MEASURE -->
<A NAME="MeasureSection"></A>
<H2>
Measurements</H2>
<P>
Measure distances, angles, surfaces, and volumes.

<!-- MODELS -->
<A NAME="ModelsSection"></A>
<H2>
Models</H2>
<P>
Click on the name of a model to make it visible.

<P>Move the slider to adjust its opacity.

<P>The color of the slider matches the color of the model.

<P>To change a model's color, edit the MRML file.
See the <B>Colors-Info</B> page information on Color nodes in a MRML file.

<!-- VOLUMES -->
<A NAME="VolumesSection"></A>
<H2>
Volumes</H2>
<P>
Adjust the window, level, and threshold of volumes using the <B>Volumes Popup</B> 
which can be found though one of the following ways:
<UL>
<LI>
Click the right mouse button on the annotation in the lower left corner
of a <B>Slice Window</B>.
<LI>
When viewing the <B>Slice Controls</B>, click the right mouse button on
the name of the volume.
</UL>
<P>
Click the <B>Volumes</B> button on the Main Menu to set other volume parameters
for interpolation, choosing color palettes, and filtering.

<!-- GUIDANCE -->
<A NAME="GuidanceSection"></A>
<H2>
Guidance</H2>
<H3>
Select a Target</H3>
<P>
Go to the <B>Guidance-Target</B> page and click on <B>Red</B> or <B>Yellow</B>
to specify which target to adjust. The next operations you perform will
apply to that target.&nbsp;
<H3>
<P>
Adjust a Target</H3>
Click the <B>Visible</B> button to see the target.&nbsp;

<P>Set the target's position by moving the sliders.&nbsp;

<P>Click the <B>Use as Focal Point</B> button to center all slices and
the view through the 3D Window on the target. Click <B>Center</B> on the Closeup
Window to reset the Focal Point to the center of the coordinate system.

<!-- REALTIME -->
<A NAME="RealtimeSection"></A>
<H2>
Realtime</H2>
<UL>
<LI><A HREF="#RealtimeOverview">Overview</A>
<LI><A HREF="#RealtimeConnect">Connecting</A>
<LI><A HREF="#RealtimeFail">When Connecting Fails</A>
<LI><A HREF="#RealtimePatient">Setting Patient Position</A>
<LI><A HREF="#RealtimeOffset">Moving the Locator's Tip</A>
</UL>

<A NAME="RealtimeOverview"></A>
<H3>Overview</H3>
<P>
The <I>3D Slicer</I> can open a network connection to the workstation
of an IntraOperative MR suite.  The position and orientation of a tracked
locator device can be received in real-time and rendered in the 3D window.

<A NAME="RealtimeConnect"></A>
<H3>Connecting</H3>
<P>
Follow theses steps to open a connection to the IntraOperative workstation:
<UL>
<LI>In a terminal window on the IntraOperative workstation, type 
<I>start_spl_server</I>.
<LI>Go to the <I>3D Slicer's</I> <B>Realtime-Realtime</B> page and
click the <B>Connect</B> button.
</UL>

<A NAME="RealtimeFail"></A>
<H3>When Connecting Fails</H3>
<P>
Any time that the Connect button is pressed in, the network connection is ok.
If the button ever pops up, then the connection failed for some reason.
Simply press it again to re-establish the connection.
<P>
The server running on the IntraOperative workstation is concurrent.
This means that each time you press the Connect button, it spawns a child
process to serve the <I>3D Slicer</I>.  Should the child crash, the parent
continues to run so that you need only press the Connect button again.
Then a new child will be spawned to receive and process commands from the 
<I>3D Slicer</I>.
<P>
If you have any troubles connecting, edit the <I>slicer.init</I> file
to change the workstation's host name and port number.  This is mentioned
in the appendix.

<A NAME="RealtimePatient"></A>
<H3>Setting Patient Position</H3>
<P>
On the <B>Realtime-Realtime</B> page, always set the patient position values.
This is necessary to render the locator at the correct location in the
3D window.

<A NAME="RealtimeOffset"></A>
<H3>Moving the Locator's Tip</H3>
<P>
You may wish to render the locator at a position that is offset from its
true tip.  This would be desired if the locator was attached to another
device, for example.
<P>
This involves measuring the offset between the real tip and the virtual
tip along 3 orthogonal directions and entering the amount in millimeters
in the fields under the <B>Offset from Locator Tip</B> heading on the 
<B>Realtime-Realtime</B> heading.  The 3 offsets are:
<UL>
<LI><B>Normal</B>: along the length of the needle, towards the tip.
<LI><B>Transverse</B>: along the handle of the 3-LED handpiece, towards the user.
<LI><B>Normal x Transverse</B>: perpendicular to the other two according to
the right-hand rule.
</UL>

<!-- VIEW -->
<A NAME="ViewSection"></A>
<H2>
View</H2>
<UL>
<LI><A HREF="#ViewOverview">Overview</A>
<LI><A HREF="#ViewNav">Navigating the 3D View</A>
<LI><A HREF="#ViewMode">Changing the View Mode</A>
<LI><A HREF="#ViewResize">Resizing the 3D Window</A>
<LI><A HREF="#ViewFOV">Changing the Field Of View</A>
<LI><A HREF="#ViewPresets">Storing your Favorites</A>
</UL>
<A NAME="ViewOverview"></A>
<H3>
Overview</H3>
<P>
Access the most commonly used view controls by moving the mouse over the
Close-up Window. The window switches to showing the View Controls, and it
returns to being a Closeup Window when the mouse is moved away.

<A NAME="ViewNav"></A>
<H3>
Navigating the 3D View</H3>
<P>
Adjust the 3D view by dragging the mouse in the <B>3D Window</B>
while pressing one of the following mouse buttons:
<UL>
<LI>
<B>Left:</B> Rotate</LI>
<LI>
<B>Middle:</B> Shift (Press the SHIFT key and the left mouse button
on a two-button mouse).</LI>
<LI>
<B>Right:</B> Zoom</LI>
</UL>
<P>
You may quickly reset the viewing direction to be along one of the coordinate
axes in RAS space.  On the Close-up Window is an image of a head with the
axes labeled (shown below).  Position the mouse over the desired axis label (ie: R) so the 
label turns color from white to red.  Then click the left mouse button.
The Focal Point will also reset to (0, 0, 0).
<P>
<IMG SRC="navdir.gif">
<P>
To quickly rotate in 15 degree increments, click on the head of an arrow
on the Rotation Pad (shown below) on the Close-up Window.
<P>
<IMG SRC="rotateNone.gif">
<P>

<A NAME="ViewMode"></A>
<H3>
Changing the View Mode</H3>
<P>
The <I>3D Slicer</I> has 4 different view modes which determine how the
3D Window and 3 Slice Windows are sized and arranged on the screen.
You can change the mode on the Close-up Window or the <B>View-Layout</B> page.
The available modes are:
<UL>
<LI>
<B>Normal:</B> The 3D Window is above the 3 Slice windows below it.
The Slice Windows have dimensions 256x256.  The 3D Window has width 768 and
height according to the <I>viewerHeightNormal</I> parameter in the 
<I>slicer.config</I> file.
<LI>
<B>4x256:</B> All windows are 256x256.  This mode is useful for running on
notebook computers with small screen resolutions, or for recording to NTSC
video.
<LI>
<B>4x512:</B> All windows are 512x512.
<LI>
<B>3D:</B> The Slice Windows are not visible.  The 3D Window's dimensions
are initially set according to the <I>viewerWidth</I> and <I>viewerHeight</I>
parameters of the <I>slicer.config</I> file.  They can be changed on the
<B>View-Layout</B> page.
</UL>

<A NAME="ViewResize"></A>
<H3>
Resizing the 3D Window</H3>
<P>
The 3D Window's dimensions
are initially set according to the <I>viewerWidth</I> and <I>viewerHeight</I>
parameters of the <I>slicer.config</I> file.  They can be changed on the
<B>View-Layout</B> page.

<A NAME="ViewFOV"></A>
<H3>
Changing the Field Of View</H3>
<P>
On the View Controls on the Close-up Window, type a number in millimeters 
into the field labeled <B>FOV</B> and press the ENTER key.
<P>
To set the Focal Point to (0, 0, 0) of RAS space, click the <B>Center</B>
button.

<A NAME="ViewPresets"></A>
<H3>
Storing your Favorites</H3>
<P>
On the View Controls on the Close-up Window, there are 3 buttons labeled
<B>1</B>, <B>2</B>, and <B>3</B>.  These buttons function in a manner similar
to the presets on your car radio.  
<P>
To store a setting, set up the 3D view as desired,
and click and hold a preset button until it turns red.
<P>
To recall a previously stored setting, click the appropriate button.
<P>
The initial settings used at start-up are stored in the <I>slicer.init</I> file.
Edit this file to your liking.

<!-- SAVE -->
<A NAME="SaveSection"></A>
<H2>
Save</H2>
<UL>
<LI><A HREF="#SaveImage">Save a 3D Image</A>
<LI><A HREF="#SaveScene">Save a Scene</A>
<LI><A HREF="#SaveState">Save the Program State</A>
</UL>
<A NAME="SaveImage"></A>
<H3>
Save a 3D Image</H3>
<P>
There is a <B>Prefix</B> button followed by an entry field.
You may type the prefix of the output file's name in the field,
or you may click the Prefix button to launch a graphical tool for
specifying the file.  (<B>TIP:</B> Type the first part of the prefix, and then 
press the ENTER key to launch the graphical tool for specifying the remainder
of the prefix.)  The <B>prefix</B> is the full path name for the file without
the portion after a period, and without a number immediately before the period.
For example, if the file name is "/local/data/image1.ppm", 
then the prefix is "/local/data/image".
<P>
Once the prefix has been specified, you need not do it again.
The <I>3D Slicer</I> appended a 1 to the prefix the first time.
Each time you click the <B>Save 3D Image</B> button, the program
increments the number to form a new file name.
<P>
<B>TIP:</B> You can also save the 3D image by clicking the <B>Save 3D</B> 
button on the Close-up Window.

<A NAME="SaveScene"></A>
<H3>
Save a Scene</H3>
<P>
Go to the <B>Save-Scene</B> page to save a MRML file that contains all
the colors and current viewing parameters as well as the descriptions of
volumes and models.

<A NAME="SaveState"></A>
<H3>
Save the Program State</H3>
<P>
Go to the <B>Save-Scene</B> page to save or restore the state of the <I>3D
Slicer</I>. The <B>Auto</B> state is automatically saved every minute.
In the event of a program crash, reboot and go to this page. Select <B>Previous</B>
from the listbox and click the <B>Load</B> button.

<!-- COLORS -->
<A NAME="ColorsSection"></A>
<H2>
Colors</H2>
<UL>
<LI><A HREF="#ColorsOverview">Overview</A>
<LI><A HREF="#ColorsSpecify">Specifying Your Own Colors</A>
<LI><A HREF="#ColorsEdit">Editing a Color</A>
<LI><A HREF="#ColorsAdd">Adding a Color</A>
<LI><A HREF="#ColorsApply">Applying Changes</A>
<LI><A HREF="#ColorsLoad">Loading Colors</A>
</UL>
<A NAME="ColorsOverview"></A>
<H3>
Overview</H3>
<P>
Colors are a type of node in a MRML file.  
Color nodes define colors by describing not only the actual color value, but also
its name and a list of label values.
<P>
Color nodes are used by the <I>3D Slicer</I> for displaying models and label maps.
One attribute of a model node is the name of its color.  If there is a Color
node with that name, then the model is displayed using the attributes of that
color node.  If not, then the model appears plain white.
When displaying a label map, each voxel is given a color by finding a Color
node with that voxel's value in its list of label values.

<A NAME="ColorsSpecify"></A>
<H3>Specifying Your Own Colors</H3>
<P>
You can specify your own colors by including Color nodes in the MRML file
that you load into the <I>3D Slicer</I>.
If the <I>3D Slicer</I> loads a MRML file that contains no Color nodes, then
it loads the <I>Colors.mrml</I> file in the <I>3D Slicer's</I> home directory. 
<P>
A second way to specify your own colors, is to force the <I>3D Slicer</I> to
load a different <I>Colors.mrml</I> file that you have edited.
To substitute your own <I>Colors.mrml</I> file, include a file of that name
in the directory where you launch the <I>3D Slicer</I>.  (NOTE: this technique
works for overriding any initialization or source file used by the <I>3D Slicer</I>.)

<A NAME="ColorsEdit"></A>
<H3>Editing a Color</H3>
<P>
Go to the <B>Colors-Edit</B> page and click on a color's name in the <B>Color Name</B>
listbox.  Then, adjust the sliders under the <B>Color Attributes</B> heading.
<P>
Delete label values by clicking on them and then pressing the <B>Del Label</B> button. 
Add new label values by typing the value below the listbox and then pressing the ENTER
key or the <B>Add Label</B> button.
<P>
The new color will not be applied to the currently displayed data until
you follow the instructions for applying changes.

<A NAME="ColorsAdd"></A>
<H3>Adding a Color</H3>
<P>
Type a name for a new color in the field below the <B>Color Name</B> listbox.
Then press the ENTER key or slick the <B>Add Color</B> button.
While the new color's name is selected in the listbox,
follow the instructions above for editing a color.
<P>
The new color will not be applied to the currently displayed data until
you follow the instructions for applying changes.

<A NAME="ColorsApply"></A>
<H3>Applying Changes</H3>
<P>
Go to the <B>Colors-Apply</B> page and type the prefix (do not include the .mrml
ending) for a MRML file.  Then click the <B>Save</B> button to write the color
definitions into a MRML file.
<P>
To apply your changes to the data that is currently
loaded into the <I>3D Slicer</I>, click <B>Apply</B>.

<A NAME="ColorsLoad"></A>
<H3>Loading Colors</H3>
<P>
Colors can be read from a MRML file into the <I>3D Slicer</I> and applied
to the currently displayed data.  Go to the <B>Colors-Apply</B> page and 
type the prefix (do not include the .mrml ending) for a MRML file.  
Then click the <B>Load and Apply</B> button.

<!-- ANNO -->
<A NAME="AnnoSection"></A>
<H2>
Annotation</H2>
<P>
There are two types of annotation:
<UL>
<LI><B>3D</B>: annotation in the 3D view.
<LI><B>2D</B>: annotation on the Slice Windows.
</UL>

<H3>Visibility</H3>
<P>
On the <B>Anno-Anno</B> page, click on the name of an annotation item to 
toggle its visibility.

<H3>Position</H3>
<P>
The cube and axes in the 3D Window can be chosen to either move with the
focal point, or stay at coordinate (0, 0, 0) in RAS space.  The focal point
is where the camera is looking.

<H3>Slice Coordinates</H3>
<P>
The upper left corner of a Slice Window displays the coordinates for the
position of the mouse.  Click the right mouse button on this text to view
a menu that allows selecting one of the following coordinate systems:
<UL>
<LI><B>RAS</B>: 3D world space
<LI><B>IJK</B>: The internal coordinate system of the data of 
slice's Background Volume.  K=0 corresponds to the first slice.
Any negative number corresponds to a point outside the volume.
<LI><B>XY</B>: The 2D coordinate of the slice where (0,0) is the 
bottom left cornder.
</UL>

</TD>
</TR>
</TABLE>

&nbsp;
<BR>

<!-- FOOTER TABLE -->
<TABLE BORDER=0 CELLSPACING=0 WIDTH="100%" >
<TR>
<TD VALIGN=TOP COLSPAN="2">
<CENTER><I><FONT SIZE=-1>This page was last updated January 20, 1999</FONT></I></CENTER>
</TD>
</TR>

<TR>
<TD VALIGN=TOP COLSPAN="2">
<HR>
<CENTER>
<A HREF="#IntroSection">Introduction</A> | 
<A HREF="#SlicesSection">Slices</A> | 
<A HREF="#FileSection">File</A> | 
<A HREF="#EditSection">Edit</A> | 
<A HREF="#MeasureSection">Measure</A> |
</CENTER>
<CENTER>
<A HREF="#RegisterSection">Register</A> |
<A HREF="#ModelsSection">Models</A> |
<A HREF="#VolumesSection">Volumes</A> |
<A HREF="#GuidanceSection">Guidance</A> | 
<A HREF="#RealtimeSection">Realtime</A> | 
</CENTER>
<CENTER>
<A HREF="#ViewSection">View</A> |
<A HREF="#SaveSection">Save</A> |
<A HREF="#ColorsSection">Colors</A> |
<A HREF="#AnnoSection">Annotation</A> |
</CENTER>
<CENTER>
<A HREF="mrmlaid.html">MRMLaid</A> |
<A HREF="appendix.html">Appendix</A>
<HR></CENTER>
</TD>
</TR>

<TR>
<TD><FONT SIZE=-1>For information, email:</FONT>&nbsp;
<BR><FONT SIZE=-1><A HREF="mailto:slicer@ai.mit.edu">slicer@ai.mit.edu</A></FONT>&nbsp;</TD>

<TD>
<DIV ALIGN=right><FONT SIZE=-2>Copyright &copy; 1999 David Gering</FONT>&nbsp;</DIV>

<DIV ALIGN=right><FONT SIZE=-2>All Rights Reserved.</FONT>&nbsp;</DIV>
</TD>
</TR>
</TABLE>
&nbsp;
</BODY>
</HTML>

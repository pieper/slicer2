<HTML>
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
   <META NAME="keywords" CONTENT="MRML, Medical Reality Modeling Language, Image Guided Surgery, Surgical Planning Lab, 3D Slicer">
   <META NAME="description" CONTENT="MRMLaid">
   <META NAME="distribution" CONTENT="global">
   <TITLE>MRMLaid</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" LINK="#0000FF" VLINK="#800080">
&nbsp;
<BR><!-- HEADER TABLE -->
<TABLE BORDER=0 CELLSPACING=0 WIDTH="100%" >
<TR>
<TD VALIGN=TOP><!-- TITLE TABLE -->
<TABLE BORDER=0 CELLSPACING=0 >
<TR>
<TD VALIGN=TOP><IMG SRC="slicer.jpg" HEIGHT=175 WIDTH=175>&nbsp;</TD>
</TR>

<TR>
<TD VALIGN=BOTTOM BGCOLOR="#0000FF">
<CENTER><B><FONT COLOR="#FFFFFF"><FONT SIZE=+3>MRMLaid&nbsp;</FONT></FONT></B></CENTER>
</TD>
</TR>
</TABLE>
&nbsp;</TD>

<TD ALIGN=LEFT VALIGN=TOP><B><I>Table of Contents</I></B>&nbsp;
<BR><A HREF="#Overview">Overview</A>
<BR><A HREF="#Defaults.mrml">Defaults.mrml</A>
<BR><A HREF="#API">Programming API</A>
<BR><A HREF="#XML">XML and MRML's Future</A>
</TR>
</TABLE>
<!-- CONTENT TABLE -->
<TABLE BORDER=0 CELLSPACING=0 WIDTH="100%" >
<TR>
<TD VALIGN=TOP>&nbsp;
<A NAME="Overview"></A>
<H1>Overview</H1>
<P>
Visualizing medical data involves combining various data sets into a single scene, 
and exploring the scene interactively.  The Medical Reality Modeling Language (MRML) 
presents a format for describing scenes that consist of various types of data sets
collected in various geometric locations.
<P>
MRML describes scenes composed of volumes and surface models.  Volumes are 3D arrays 
of volume elements called voxels.  Surface models are sets of triangles 
arranged in 3D space to form a closed surface.  MRML files are not a copy of the
data in another format.  Instead, a MRML file describes where the data is stored 
so the data can remain in its original format and location.  Second, a MRML file 
describes how to position the data sets relative to each other in 3D space.  
Third, a MRML file describes how to display the data by specifying 
parameters for rendering and coloring.
<P>
A scene is represented as a tree-like graph where volumes, models, 
and other items are the nodes in the graph.  Each node has attributes for
specifying its data.  Each type of node is briefly described here and detailed
in the next section.

<H2>Volume</H2>
Volume nodes describe data sets that can be thought of as stacks of
2D images that form a 3D volume.  Volumes tend to consist of either grayscale data,
such as from an MR or CT scan, or label maps.  Label maps are the result of
segmenting a grayscale data set into its component tissues.  
Each voxel is assigned membership in an anatomical structure, such as skin, 
brain, vessel, or tumor.  The output of the segmentation process is a label map 
where each voxel contains a number, or label, corresponding to its classification.  

<H2>Model</H2> 
Model nodes describe polygonal data.  A surface model can be made from 
a label map by creating triangles that bound all voxels of a common label to 
form a closed surface.  A MRML file can express which volume the models were made from
by enclosing the volume and its models inside a separator, and placing the volume
ahead of its models.

<H2>Transform</H2> 
Often in medical imaging, patients are scanned at different times or at different 
orientations.  Different volumes can then be aligned through a registration process.
The output of a rigid body registration is a rotation and 
translation expressed mathematically as a transformation matrix.  These transforms
can be inserted into MRML files as transform nodes.  Each transform affects volumes
and models that appear below it in the MRML file.  When transforms appear inside 
a separator, then only affect volumes and models that are also inside the separator.
Multiple transforms can be concatenated together.

<H2>Separator</H2>
A separator is not a node with attributes, but it is a useful construct 
for building MRML files.  A separator encapsulates the nodes inside it such 
that they are invisible to nodes outside the separator.  Separators can be used
to achieve two types of effects:
<UL>
<LI> Any transform node inside a separator will only affect volumes
and models that are positioned both inside the separator, and after the transform.
<LI> Any model node inside a separator will be interpreted to belong to the volume
node that is the most immediately above it and also inside the separator.
</UL>

<H2>Url</H2>
A Url node can serve one of two purposes:
<UL>
<LI> State the path of another MRML file to effectively place the contents of the
other file into this one.
<LI> State a root path from which relative paths (in volume and model nodes)
are based.
</UL>

<H2>Config</H2>
Config nodes allow for a MRML browser, such as the <I>3D Slicer</I>, to be configured
at startup.

<H2>Color</H2>
Color nodes define colors by describing not only the actual color value, but also
its name and a list of label values.  One attribute of model nodes is the name of
its color.  When the <I>3D Slicer</I> displays label maps, it colors each voxel
according to the list of label values associated with each color node.

<A NAME="Defaults.mrml"></A>
<H1>Defaults.mrml</H1>
<P>
The <I>Defaults.mrml</I> file defines each node and its attributes.
Attributes are listed as key-value pairs where the key is the first word on the line,
and the key's value is the remainder of the line.  This section describes each
attribute of each type of node.

<H2>Volume Node</H2>
<TABLE BORDER=0 CELLSPACING=2 CELLPADDING=5 WIDTH="95%">
<TR>
<TH ALIGN=LEFT BGCOLOR="#A6CAF0"><FONT FACE="Arial"><FONT SIZE=-1><B>
Key</B>&nbsp;</FONT></FONT></TH>
<TH ALIGN=LEFT BGCOLOR="#A6CAF0"><FONT FACE="Arial"><FONT SIZE=-1><B>
Value</B>&nbsp;</FONT></FONT></TH>
</TR>
<TR><TD>name</TD><TD>Name displayed on the user interface</TD></TR>
<TR><TD>labelMap</TD><TD>1 if the data is a label map, else 0</TD></TR>
<TR><TD>filePattern</TD><TD>The pattern for nameing the files expressed in
C language syntax.  For example, a file named <I>skin.001</I> has a patter of
%s.%03d, and a file named <I>skin.1</I> has a pattern of %s.%d</TD></TR>
<TR><TD>filePrefix</TD><TD>Prefix of the image files.  For example, the prefix of
/d/skin.001 is /d/skin</TD></TR>
<TR><TD>headerSize</TD><TD>Size of the header of each image file, in bytes.</TD></TR>
<TR><TD>imageRange</TD><TD>Two numbers: the first and last image numbers in the volume.
For example: 1 124</TD></TR>
<TR><TD>dimensions</TD><TD>Two numbers of the X and Y dimensions of each image,
in pixels</TD></TR>
<TR><TD>spacing</TD><TD>Three numbers for the dimensions of each voxel, in millimeters</TD></TR>
<TR><TD>littleEndian</TD><TD>1 for little endian (file generated on a PC or SGI), else 0 for big endian</TD></TR>
<TR><TD>scalarType</TD><TD>The type of data in the file.  One of: Integer, Float, Short, Char,
UnsignedChar</TD></TR>
<TR><TD>numScalars</TD><TD>The number of scalar components for each voxel.  Gray-scale
data has 1.  Color data has 3.</TD></TR>
<TR><TD>rasToIjkMatrix</TD><TD>The matrix that transforms a point in RAS space
to IJK space</TD></TR>
<TR><TD>rasToVtkMatrix</TD><TD>Same as the rasToIjkMatrix except the y-axis is directed
up instead of down, as is the case in VTK</TD></TR>
<TR><TD>scanOrder</TD><TD>The order of slices in the volume.  
One of: LR (left-to-right), RL, AP, PA, IS, SI, OB (oblique).
This information is encoded in the rasToIjkMatrix, so it is only stated here
as a convenience to people reading the file</TD></TR>
<TR><TD>autoWindowLevel</TD><TD>1 if windowing and leveling are to be performed
automatically, else 0</TD></TR>
<TR><TD>window</TD><TD>The window value to use when autoWindowLevel is 0</TD></TR>
<TR><TD>level</TD><TD>The level value to use when autoWindowLevel is 0</TD></TR>
<TR><TD>ignore</TD><TD>If 1, then the volume is ignored as if it weren't in the file.</TD></TR>
<TR><TD>options</TD><TD>Name of the program followed by a space-delimited list of
key-value pairs.  For example: slicer showAbove 10 showBelow 100</TD></TR>
<TR><TD>desc</TD><TD>Text description of the data</TD></TR>
</TABLE>

<H2>Model Node</H2>
<TABLE BORDER=0 CELLSPACING=2 CELLPADDING=5 WIDTH="95%">
<TR>
<TH ALIGN=LEFT BGCOLOR="#A6CAF0"><FONT FACE="Arial"><FONT SIZE=-1><B>
Key</B>&nbsp;</FONT></FONT></TH>
<TH ALIGN=LEFT BGCOLOR="#A6CAF0"><FONT FACE="Arial"><FONT SIZE=-1><B>
Value</B>&nbsp;</FONT></FONT></TH>
</TR>
<TR><TD>name</TD><TD>Name to appear on the user interface</TD></TR>
<TR><TD>fileName</TD><TD>Path of the data file</TD></TR>
<TR><TD>colorName</TD><TD>Name of the model's color, which is defined by a Color node
in a MRML file.</TD></TR>
<TR><TD>opacity</TD><TD>Opacity of the surface expressed as a number from 0 to 1.</TD></TR>
<TR><TD>visibility</TD><TD>1 if visible, else 0</TD></TR>
<TR><TD>scalarRange</TD><TD>Range of scalar values to render rather than the single
color designated by colorName</TD></TR>
<TR><TD>scalarVisibility</TD><TD>1 if scalars (within the scalarRange) are visible, else 0</TD></TR>
<TR><TD>backfaceCulling</TD><TD>1 if on, 0 if off</TD></TR>
<TR><TD>ignore</TD><TD>If 1, then the volume is ignored as if it weren't in the file.</TD></TR>
<TR><TD>options</TD><TD>Name of the program followed by a space-delimited list of
key-value pairs.  For example: slicer showAbove 10 showBelow 100</TD></TR>
<TR><TD>desc</TD><TD>Text description of the data</TD></TR>
</TABLE>

<H2>Color Node</H2>
<TABLE BORDER=0 CELLSPACING=2 CELLPADDING=5 WIDTH="95%">
<TR>
<TH ALIGN=LEFT BGCOLOR="#A6CAF0"><FONT FACE="Arial"><FONT SIZE=-1><B>
Key</B>&nbsp;</FONT></FONT></TH>
<TH ALIGN=LEFT BGCOLOR="#A6CAF0"><FONT FACE="Arial"><FONT SIZE=-1><B>
Value</B>&nbsp;</FONT></FONT></TH>
</TR>
<TR><TD>name</TD><TD>Name to appear on the user interface</TD></TR>
<TR><TD>diffuseColor</TD><TD>Diffuse component of color expressed as 3 RGB 
(Red Green Blue) values in the range of 0 to 1</TD></TR>
<TR><TD>ambient</TD><TD>Factor of the affect of ambient light from 0 to 1</TD></TR>
<TR><TD>diffuse</TD><TD>Factor of the affect of diffuse reflection from 0 to 1</TD></TR>
<TR><TD>specular</TD><TD>Factor of the affect of specular reflection from 0 to 1</TD></TR>
<TR><TD>power</TD><TD>Specular power in the range of 1 to 100</TD></TR>
<TR><TD>labels</TD><TD>List of label values associated with this color</TD></TR>
<TR><TD>options</TD><TD>Name of the program followed by a space-delimited list of
key-value pairs.  For example: slicer showAbove 10 showBelow 100</TD></TR>
</TABLE>

<H2>Transform Node</H2>
<TABLE BORDER=0 CELLSPACING=2 CELLPADDING=5 WIDTH="95%">
<TR>
<TH ALIGN=LEFT BGCOLOR="#A6CAF0"><FONT FACE="Arial"><FONT SIZE=-1><B>
Key</B>&nbsp;</FONT></FONT></TH>
<TH ALIGN=LEFT BGCOLOR="#A6CAF0"><FONT FACE="Arial"><FONT SIZE=-1><B>
Value</B>&nbsp;</FONT></FONT></TH>
</TR>
<TR><TD>matrix</TD><TD>16 numbers that form a 4x4 matrix.  The matrix is multiplied
by one point (M*P) to compute the new point</TD></TR>
<TR><TD>scale</TD><TD>3 numbers for X Y Z scaling</TD></TR>
<TR><TD>rotateX</TD><TD>1 number for rotation about the X axis in degrees</TD></TR>
<TR><TD>rotateY</TD><TD>rotation about the Y axis</TD></TR>
<TR><TD>rotateZ</TD><TD>rotation about the Z axis</TD></TR>
<TR><TD>translate</TD><TD>3 numbers for translation in X Y Z in millimeters</TD></TR>
<TR><TD>desc</TD><TD>Text description of the data</TD></TR>
</TABLE>

<H2>Config Node</H2>
<TABLE BORDER=0 CELLSPACING=2 CELLPADDING=5 WIDTH="95%">
<TR>
<TH ALIGN=LEFT BGCOLOR="#A6CAF0"><FONT FACE="Arial"><FONT SIZE=-1><B>
Key</B>&nbsp;</FONT></FONT></TH>
<TH ALIGN=LEFT BGCOLOR="#A6CAF0"><FONT FACE="Arial"><FONT SIZE=-1><B>
Value</B>&nbsp;</FONT></FONT></TH>
</TR>
<TR><TD>options</TD><TD>Name of the program followed the name of a category
followed by a space-delimited list of
key-value pairs.  For example: slicer View bgColorR .3 bgColorG .5 bgColorB .7</TD></TR>
</TABLE>

<H2>Url Node</H2>
<TABLE BORDER=0 CELLSPACING=2 CELLPADDING=5 WIDTH="95%">
<TR>
<TH ALIGN=LEFT BGCOLOR="#A6CAF0"><FONT FACE="Arial"><FONT SIZE=-1><B>
Key</B>&nbsp;</FONT></FONT></TH>
<TH ALIGN=LEFT BGCOLOR="#A6CAF0"><FONT FACE="Arial"><FONT SIZE=-1><B>
Value</B>&nbsp;</FONT></FONT></TH>
</TR>
<TR><TD>url</TD><TD>Path</TD></TR>
<TR><TD>link</TD><TD>If 1, then the url is a link to another MRML file.  If 0, then
other data sets in the file are relative to this url.</TD></TR>
</TABLE>

<A NAME="API"></A>
<H1>Programming API</H1>
<P>
An application programming interface (API) allows programs written with the
Tcl/Tk scripting language to parse and write MRML files.  The API is contained, 
and documented, in the MRMLapi.tcl and MRMLvolume.tcl files of the tcl subdirectory
in the <I>3D Slicer's</I> home directory.

<A NAME="XML"></A>
<H1>XML and MRML's Future</H1>
<P>
XML is the next generation of HTML for use as the document langauge of the 
world wide web.  HTML tags data with instructions of how a browser should 
interpret the data.  Example tags are images, links, and tables.  
XML extends this functionality by allowing users to define their own tags.
<P>
The next generation of MRML will be a type of XML document where new tags 
have been defined to handle medical data such as volumes and surface models. 
Just as HTML points to jpg and gif images, but does not contain the image 
data itself in the HTML document, MRML describes where the medical data is,
and how to display it.  The data itself remains in its original location 
and in its original format.
<P>
There can be two uses of MRML.  First, a MRML file can be thought of as 
a description of a scene.  Programs such as the <I>3D Slicer</I> are MRML browsers
that load a MRML file and allow the user to interact with the data in a 3D scene.
Secondly, MRML files can be organized hierarchically to form a database.
One advantage to implementing databases in XML is that scripts can
easily parse the XML files to navigate the data fully automatically to perform
large-scale batch operations, such as registering thousands of volumes together.

</TD>
</TR>
</TABLE>

&nbsp;
<BR>

<!-- FOOTER TABLE -->
<TABLE BORDER=0 CELLSPACING=0 WIDTH="100%" >
<TR>
<TD VALIGN=TOP COLSPAN="2">
<CENTER><I><FONT SIZE=-1>This page was last updated January 20, 1999</FONT></I></CENTER>
</TD>
</TR>

<TR>
<TD VALIGN=TOP COLSPAN="2">
<HR>
<CENTER>
<A HREF="#Overview">Overview</A> |
<A HREF="#Defaults.mrml">Defaults.mrml</A>
</CENTER>
<CENTER>
<A HREF="#API">Programming API</A> |
<A HREF="#XML">XML and MRML's Future</A> 
</CENTER>
<HR>
</TD>
</TR>

<TR>
<TD><FONT SIZE=-1>For information, email:</FONT>&nbsp;
<BR><FONT SIZE=-1><A HREF="mailto:slicer@ai.mit.edu">slicer@ai.mit.edu</A></FONT>&nbsp;</TD>

<TD>
<DIV ALIGN=right><FONT SIZE=-2>Copyright &copy; 1999 David Gering</FONT>&nbsp;</DIV>

<DIV ALIGN=right><FONT SIZE=-2>All Rights Reserved.</FONT>&nbsp;</DIV>
</TD>
</TR>
</TABLE>
&nbsp;
</BODY>
</HTML>
